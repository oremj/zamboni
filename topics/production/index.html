

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Zamboni in Production &mdash; zamboni v0.8 documentation</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="zamboni v0.8 documentation" href="../../" />
    <link rel="next" title="Search (powered by Sphinx, but not the documenter)" href="../search/" />
    <link rel="prev" title="Packaging in Zamboni" href="../packages/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../search/" title="Search (powered by Sphinx, but not the documenter)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../packages/" title="Packaging in Zamboni"
             accesskey="P">previous</a> |</li>
        <li><a href="../../">zamboni v0.8 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="zamboni-in-production">
<span id="production"></span><h1>Zamboni in Production<a class="headerlink" href="#zamboni-in-production" title="Permalink to this headline">¶</a></h1>
<div class="section" id="getting-requirements">
<h2>Getting Requirements<a class="headerlink" href="#getting-requirements" title="Permalink to this headline">¶</a></h2>
<p>Grab zamboni from github with</p>
<div class="highlight-python"><pre>git clone git://github.com/jbalogh/zamboni.git
git submodule update --init</pre>
</div>
<p>You&#8217;re going to need virtualenv and pip, but I&#8217;ll let you figure that one out.</p>
<p>We rely on one compiled package, MySQLdb.  It needs to link against the
mysql-dev headers, so install that one system-wide.  The rest of our packages
should be installed in a virtualenv using pip.  If you&#8217;re oremj, do this:</p>
<div class="highlight-python"><pre>pip install http://sm-hudson01.mozilla.org:8080/job/addons.mozilla.org/ws/packages/amo.pybundle</pre>
</div>
<p>Otherwise, get them from the internet like this:</p>
<div class="highlight-python"><pre>pip install -r requirements-prod.txt</pre>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>We keep most of our config in <tt class="docutils literal"><span class="pre">settings.py</span></tt> under version control.  Local
config can be overridden in <tt class="docutils literal"><span class="pre">settings_local.py</span></tt>.  This template, inlined
below,  can be found at <a class="reference external" href="http://github.com/jbalogh/zamboni/tree/master/docs/settings/settings_local.prod.py">docs/settings/settings_local.prod.py</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">TEMPLATE_DEBUG</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c"># The default database should point to the master.</span>
<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="s">&#39;zamboni&#39;</span><span class="p">,</span>
        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.mysql&#39;</span><span class="p">,</span>
        <span class="s">&#39;HOST&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="s">&#39;PORT&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="s">&#39;USER&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="s">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;init_command&#39;</span><span class="p">:</span> <span class="s">&#39;SET storage_engine=InnoDB&#39;</span><span class="p">},</span>
    <span class="p">},</span>
    <span class="s">&#39;slave&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="s">&#39;zamboni&#39;</span><span class="p">,</span>
        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.mysql&#39;</span><span class="p">,</span>
        <span class="s">&#39;HOST&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="s">&#39;PORT&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="s">&#39;USER&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="s">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;init_command&#39;</span><span class="p">:</span> <span class="s">&#39;SET storage_engine=InnoDB&#39;</span><span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="c"># Put the aliases for slave databases in this list.</span>
<span class="n">SLAVE_DATABASES</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;slave&#39;</span><span class="p">]</span>

<span class="c"># Use IP:PORT pairs separated by semicolons.</span>
<span class="n">CACHE_BACKEND</span> <span class="o">=</span> <span class="s">&#39;django_pylibmc.memcached://localhost:11211;localhost:11212?timeout=500&#39;</span>

<span class="c"># This is used to hash some things in Django.</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">&#39;replace me with something long&#39;</span>

<span class="c"># Remove any apps that are only needed for development.</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">app</span> <span class="k">for</span> <span class="n">app</span> <span class="ow">in</span> <span class="n">INSTALLED_APPS</span> <span class="k">if</span> <span class="n">app</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DEV_APPS</span><span class="p">)</span>

<span class="n">LOG_LEVEL</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span>

<span class="n">DEBUG_PROPAGATE_EXCEPTIONS</span> <span class="o">=</span> <span class="n">DEBUG</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-mod-wsgi">
<h2>Setting up mod_wsgi<a class="headerlink" href="#setting-up-mod-wsgi" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://docs.djangoproject.com/en/dev/howto/deployment/modwsgi/">http://docs.djangoproject.com/en/dev/howto/deployment/modwsgi/</a></p>
<p><a class="reference external" href="http://code.google.com/p/modwsgi/wiki/QuickConfigurationGuide">http://code.google.com/p/modwsgi/wiki/QuickConfigurationGuide</a></p>
<p>Here&#8217;s a basic httpd.conf snippet that I used to get zamboni running on my Mac:</p>
<div class="highlight-python"><pre># WSGI
LoadModule wsgi_module modules/mod_wsgi.so
WSGIPythonHome /Users/jeff/.virtualenvs/baseline

# TODO: /media and /admin-media

&lt;VirtualHost *:80&gt;  #*
    ServerName 127.0.0.1
    WSGIScriptAlias / /Users/jeff/dev/zamboni/wsgi/zamboni.wsgi

    WSGIDaemonProcess zamboni processes=8 threads=1 \
        python-path=/Users/jeff/.virtualenvs/zamboni/lib/python2.6/site-packages
    WSGIProcessGroup zamboni

    &lt;Directory /Users/jeff/dev/zamboni/wsgi&gt;
        Order allow,deny
        Allow from all
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;</pre>
</div>
<p><tt class="docutils literal"><span class="pre">WSGIPythonHome</span></tt> points at a pristine virtual environment.  That came from
<a class="reference external" href="http://code.google.com/p/modwsgi/wiki/VirtualEnvironments">http://code.google.com/p/modwsgi/wiki/VirtualEnvironments</a>.</p>
<p><tt class="docutils literal"><span class="pre">WSGIScriptAlias</span></tt> points to <tt class="docutils literal"><span class="pre">/wsgi/zamboni.wsgi</span></tt> in the zamboni checkout.</p>
<p><tt class="docutils literal"><span class="pre">WSGIDaemonProcess</span></tt> creates 8 processes and 10 threads.  Those numbers are
completely arbitrary.  I&#8217;ll update it when we know what works in production.
The <tt class="docutils literal"><span class="pre">python-path</span></tt> argument points to the site-packages directory of our
zamboni virtualenv.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This doesn&#8217;t include media or admin media yet.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Zamboni in Production</a><ul>
<li><a class="reference internal" href="#getting-requirements">Getting Requirements</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#setting-up-mod-wsgi">Setting up mod_wsgi</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../packages/"
                        title="previous chapter">Packaging in Zamboni</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../search/"
                        title="next chapter">Search (powered by Sphinx, but not the documenter)</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/topics/production.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../search/" title="Search (powered by Sphinx, but not the documenter)"
             >next</a> |</li>
        <li class="right" >
          <a href="../packages/" title="Packaging in Zamboni"
             >previous</a> |</li>
        <li><a href="../../">zamboni v0.8 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009, The Zamboni Collective.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.2.
    </div>
  </body>
</html>